<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <title>Wedding Seating Plan</title>
  <meta name="color-scheme" content="light" />
  <style>
    :root{
      --bg:#fdf8f4; --card:#fff; --ink:#2b2b2b; --muted:#6b6b6b; --brand:#b96c6c; --ring:rgba(185,108,108,.35);
    }
    *{box-sizing:border-box}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      margin:0; padding:20px; color:var(--ink);
    }
    .wrap{max-width:960px;margin:0 auto}
    header{ text-align:center; margin-bottom:18px }
    h1{
      font-size:clamp(1.25rem, 2.5vw, 1.75rem);
      line-height:1.3; margin:0 0 8px;
    }
    .subtitle{color:var(--muted); font-style:italic; font-size:.95rem}

    .searchbar{
      position:sticky; top:0; z-index:5; background:linear-gradient(var(--bg),var(--bg));
      padding:8px 0 14px; margin-bottom:6px;
    }
    label{display:block; font-size:.9rem; margin:6px 0 8px; color:var(--muted)}
    .input-row{display:flex; gap:10px; align-items:center; justify-content:center}
    input[type="text"]{
      padding:14px 16px; font-size:1.1rem; width:100%; max-width:520px;
      border-radius:12px; border:1px solid #d7d7d7; background:#fff; outline:none;
      box-shadow:0 1px 0 rgba(0,0,0,.02);
    }
    input[type="text"]:focus{ border-color:var(--brand); box-shadow:0 0 0 4px var(--ring) }
    .btn{
      appearance:none; border:1px solid #d9c9c9; background:#fff; color:#5b3b3b; padding:12px 14px;
      border-radius:12px; cursor:pointer; font-weight:600; transition:.15s transform,.15s box-shadow;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 3px 10px rgba(0,0,0,.05)}

    .result{ margin-top:10px; font-size:1.05rem }

    .list{ display:grid; gap:12px; margin:14px auto 0; max-width:720px }
    .guest-item{
      padding:14px 16px; border-radius:14px; background:var(--card);
      box-shadow:0 3px 8px rgba(0,0,0,.08);
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .who{ font-weight:700; color:#3c3c3c }
    .meta{ color:#444 }
    .seat-pill{ background:#f6ecec; border:1px solid #ecd6d6; padding:6px 10px; border-radius:999px; font-weight:700 }
    .copy{ font-size:.9rem }
    mark{ background:#fff1c2; padding:0 .12em; border-radius:.2em }

    figure{ margin:24px auto 0; text-align:center }
    figure img{ width:100%; max-width:900px; border-radius:14px; box-shadow:0 4px 12px rgba(0,0,0,.16); cursor:zoom-in }
    figcaption{ font-size:.9rem; color:var(--muted); margin-top:6px }

    /* Lightbox */
    .lightbox{ display:none; position:fixed; inset:0; z-index:1000; background:rgba(0,0,0,.8);
      justify-content:center; align-items:center; overflow:hidden }
    .lightbox[open]{ display:flex }
    .lightbox img{
      position:relative; transform:translate(var(--dx,0px),var(--dy,0px)) scale(var(--scale,.9));
      max-width:none; max-height:none; width:auto; height:auto; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,.5);
      touch-action:none; cursor:grab
    }
    .lightbox .close{ position:absolute; top:18px; right:20px; font-size:28px; color:#fff; text-decoration:none }
    .help{ position:absolute; bottom:14px; left:50%; transform:translateX(-50%); color:#fff; opacity:.8; font-size:.9rem }

    @media (max-width: 480px){
      input[type="text"]{ font-size:1.15rem; padding:12px }
      .guest-item{ font-size:1.05rem; padding:12px }
      .seat-pill{ font-size:.95rem }
      .lightbox img{ --scale: 1.8 }
    }

    /* a11y helpers */
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }

    /* Floorplan pins */
    .plan-wrap{ position:relative; display:inline-block; width:100%; max-width:900px }
    .pin-layer{ position:absolute; inset:0; pointer-events:none }
    .pin{ position:absolute; transform:translate(-50%, -100%); pointer-events:auto }
    .pin .dot{ width:14px; height:14px; border-radius:50%; background:#b96c6c; border:2px solid #fff; box-shadow:0 2px 6px rgba(0,0,0,.35)}
    .pin .label{ position:absolute; top:-26px; left:50%; transform:translateX(-50%); background:#fff; color:#5b3b3b; border:1px solid #ecd6d6; padding:2px 6px; border-radius:999px; font-size:.78rem; font-weight:700; white-space:nowrap; box-shadow:0 2px 6px rgba(0,0,0,.08)}
    .pin.highlight .dot{ animation: pulse 1.1s ease-out 3 }
    @keyframes pulse{ 0%{ box-shadow:0 0 0 0 rgba(185,108,108,.45)} 70%{ box-shadow:0 0 0 12px rgba(185,108,108,0)} 100%{ box-shadow:0 0 0 0 rgba(185,108,108,0)} }

    @media (max-width: 480px){
      .pin .label{ font-size:.72rem }
      .pin .dot{ width:12px; height:12px }
    }

    
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Seijin & Jiwon Wedding Seating Plan üë∞‚ù§Ô∏èü§µ</h1>
      <p class="subtitle">*Seats arranged clockwise from the north ü™ë</p>
    </header>

    <section class="searchbar" role="search">
      <label for="searchBox">Type your name (first or last is OK). Press ‚èé to copy your seat.</label>
      <div class="input-row">
        <input id="searchBox" name="searchBox" type="text" inputmode="search" autocomplete="off" placeholder="Enter your name‚Ä¶" aria-describedby="resultCount" />
        <button class="btn" id="clearBtn" type="button" aria-label="Clear search">Clear</button>
      </div>
      <div id="resultCount" class="result" aria-live="polite"></div>
    </section>

    <section>
      <div id="list" class="list" aria-live="polite"></div>
    </section>

<figure>
  <div class="plan-wrap">
    <a id="thumbLink" href="#" aria-label="Open floor plan">
      <img id="thumb" src="Seating_Plan.jpg" alt="Wedding floor plan thumbnail" />
    </a>
    <div id="pinLayer" class="pin-layer" aria-hidden="true"></div>
  </div>
  <figcaption>Tap to zoom & drag. Double-tap to reset. Search results can highlight the table pin.</figcaption>
</figure>

  </div>

  <!-- Modal Lightbox -->
  <dialog id="lightbox" class="lightbox" aria-label="Zoomed floor plan">
    <a href="#" class="close" id="closeX" aria-label="Close">‚úï</a>
    <div class="plan-wrap" style="max-width:min(92vw,1100px);">
      <img id="zoomImg" src="Seating_Plan.jpg" alt="Wedding floor plan large" />
      <div id="pinLayerDialog" class="pin-layer" aria-hidden="true"></div>
    </div>
    <div class="help">Drag to move ‚Ä¢ Double-tap to reset ‚Ä¢ Esc to close</div>
  </dialog>


  <script>
  // --- Data --------------------------------------------------------------
  const guests = [
    // Table 1
    { name: "Misuk Lee", table: "Table 1", seat: "Seat 1" },
    { name: "Youn Kang", table: "Table 1", seat: "Seat 2" },
    { name: "Yumi Park", table: "Table 1", seat: "Seat 3" },
    { name: "Lucia Hwang", table: "Table 1", seat: "Seat 4" },
    { name: "Daniel Hwang", table: "Table 1", seat: "Seat 5" },
    { name: "Eugene Hwang", table: "Table 1", seat: "Seat 6" },

    // Table 2
    { name: "Youngsuk Lee", table: "Table 2", seat: "Seat 1" },
    { name: "Han Yoon", table: "Table 2", seat: "Seat 2" },
    { name: "Larry Yoon", table: "Table 2", seat: "Seat 3" },
    { name: "Younglan Yoon", table: "Table 2", seat: "Seat 4" },
    { name: "Sukmo Lim", table: "Table 2", seat: "Seat 5" },
    { name: "Anthony Kim", table: "Table 2", seat: "Seat 6" },
    { name: "Laurie Yoon", table: "Table 2", seat: "Seat 7" },
    { name: "Youngsun Yoon", table: "Table 2", seat: "Seat 8" },

    // Table 3
    { name: "Joseph Lee", table: "Table 3", seat: "Seat 1" },
    { name: "Kate Oh", table: "Table 3", seat: "Seat 2" },
    { name: "Hye Suk Choi", table: "Table 3", seat: "Seat 3" },
    { name: "Jinmo Choi", table: "Table 3", seat: "Seat 4" },
    { name: "Duhwan OH", table: "Table 3", seat: "Seat 5" },
    { name: "Young Ae Yun", table: "Table 3", seat: "Seat 6" },
    { name: "Gayeon Pyo", table: "Table 3", seat: "Seat 7" },

    // Table 4
    { name: "Peter Kim", table: "Table 4", seat: "Seat 1" },
    { name: "Byeongseok Oh", table: "Table 4", seat: "Seat 2" },
    { name: "Yujin Kim", table: "Table 4", seat: "Seat 3" },
    { name: "Won Min", table: "Table 4", seat: "Seat 4" },
    { name: "Jonathan Lepine", table: "Table 4", seat: "Seat 5" },
    { name: "Min Baek", table: "Table 4", seat: "Seat 6" },
    { name: "Teresa Kim", table: "Table 4", seat: "Seat 7" },
    { name: "Micah Kim", table: "Table 4", seat: "Seat 8" },

    // Table 5
    { name: "Hamin Song", table: "Table 5", seat: "Seat 1" },
    { name: "Taesuk Song", table: "Table 5", seat: "Seat 2" },
    { name: "Yoon Lee", table: "Table 5", seat: "Seat 3" },
    { name: "Minkyung Lee", table: "Table 5", seat: "Seat 4" },
    { name: "Hajun Cho", table: "Table 5", seat: "Seat 5" },
    { name: "Jaemin Cho", table: "Table 5", seat: "Seat 6" },
    { name: "Minkyu Kim", table: "Table 5", seat: "Seat 7" },
    { name: "Aliyah Kim", table: "Table 5", seat: "Seat 8" },

    // Table 6
    { name: "Heesu Kim", table: "Table 6", seat: "Seat 1" },
    { name: "Daekeun Song", table: "Table 6", seat: "Seat 2" },
    { name: "Harim Choi", table: "Table 6", seat: "Seat 3" },
    { name: "Han Jun Ji", table: "Table 6", seat: "Seat 4" },
    { name: "Yoon Ryu", table: "Table 6", seat: "Seat 5" },
    { name: "Tony Choi", table: "Table 6", seat: "Seat 6" },

    // Table 7
    { name: "Gi Cheol Son", table: "Table 7", seat: "Seat 1" },
    { name: "Eunjoo Lee", table: "Table 7", seat: "Seat 2" },
    { name: "Seonju Lee", table: "Table 7", seat: "Seat 3" },
    { name: "Jaehyun Ko", table: "Table 7", seat: "Seat 4" },
    { name: "Soon Ok Chung", table: "Table 7", seat: "Seat 5" },
    { name: "Mi Roung Kim", table: "Table 7", seat: "Seat 6" },
    { name: "Young Sook Yang", table: "Table 7", seat: "Seat 7" },
    { name: "Bongran Lee", table: "Table 7", seat: "Seat 8" },

    // Table 8
    { name: "Minjeong Kim", table: "Table 8", seat: "Seat 1" },
    { name: "Jiwan Kim", table: "Table 8", seat: "Seat 2" },
    { name: "Jonghun Park", table: "Table 8", seat: "Seat 3" },
    { name: "Han So Chang", table: "Table 8", seat: "Seat 4" },
    { name: "Dabin Ham", table: "Table 8", seat: "Seat 5" },
    { name: "Woongbin Ham", table: "Table 8", seat: "Seat 6" },
    { name: "Chaebin Ham", table: "Table 8", seat: "Seat 7" },

    // Table 9
    { name: "Leah Lee", table: "Table 9", seat: "Seat 1" },
    { name: "Chloe Lee", table: "Table 9", seat: "Seat 2" },
    { name: "Hyunhee Park", table: "Table 9", seat: "Seat 3" },
    { name: "Bangul Han", table: "Table 9", seat: "Seat 4" },
    { name: "Hannah Lee", table: "Table 9", seat: "Seat 5" },
    { name: "Haesol Lee", table: "Table 9", seat: "Seat 6" },
    { name: "Juhong Lee", table: "Table 9", seat: "Seat 7" },
    { name: "Youngbok Lee", table: "Table 9", seat: "Seat 8" },

    // Table 10
    { name: "Kaylie Chaerim Oh", table: "Table 10", seat: "Seat 1" },
    { name: "Kasey Jiyeon Oh", table: "Table 10", seat: "Seat 2" },
    { name: "Seunghee Noh", table: "Table 10", seat: "Seat 3" },
    { name: "Minji Kang", table: "Table 10", seat: "Seat 4" },
    { name: "Elle Park", table: "Table 10", seat: "Seat 5" },
    { name: "Noah Park", table: "Table 10", seat: "Seat 6" },
    { name: "Jinwoo Park", table: "Table 10", seat: "Seat 7" },
    { name: "Jungbin Oh", table: "Table 10", seat: "Seat 8" },

    // Table 11
    { name: "Hahnul Ku", table: "Table 11", seat: "Seat 1" },
    { name: "Doyeon Oh", table: "Table 11", seat: "Seat 2" },
    { name: "Sungmin Kang", table: "Table 11", seat: "Seat 3" },
    { name: "Hyejin Nam", table: "Table 11", seat: "Seat 4" },
    { name: "Youna Oh", table: "Table 11", seat: "Seat 5" },
    { name: "Euido Jeong", table: "Table 11", seat: "Seat 6" },
    { name: "Donghyeon Ku", table: "Table 11", seat: "Seat 7" },

    // Table 12
    { name: "James Kim", table: "Table 12", seat: "Seat 1" },
    { name: "Lujayne Alhalabi", table: "Table 12", seat: "Seat 2" },
    { name: "Hee Jin Kim", table: "Table 12", seat: "Seat 3" },
    { name: "Joeun Kim", table: "Table 12", seat: "Seat 4" },
    { name: "Andy Moon", table: "Table 12", seat: "Seat 5" },
    { name: "Youngbin Nam", table: "Table 12", seat: "Seat 6" },

    // Table 13
    { name: "Caelan Mathews", table: "Table 13", seat: "Seat 1" },
    { name: "Ai Nagayama", table: "Table 13", seat: "Seat 2" },
    { name: "Kasmir Ley, Palogan", table: "Table 13", seat: "Seat 3" },
    { name: "Joy Robles", table: "Table 13", seat: "Seat 4" },
    { name: "Andrea Gelindon", table: "Table 13", seat: "Seat 5" },
    { name: "Catherine Dulay", table: "Table 13", seat: "Seat 6" },
    { name: "Vivienne Park Lee", table: "Table 13", seat: "Seat 7" },
    { name: "John Carl, Contreras", table: "Table 13", seat: "Seat 8" },

    // Table 14
    { name: "Zoe", table: "Table 14", seat: "Seat 1" },
    { name: "Sean Lee", table: "Table 14", seat: "Seat 2" },
    { name: "Joey Lee", table: "Table 14", seat: "Seat 3" },
    { name: "Louis", table: "Table 14", seat: "Seat 4" },
    { name: "Spencer", table: "Table 14", seat: "Seat 5" },

    // Table 15
    { name: "Jevan McGowan", table: "Table 15", seat: "Seat 1" },
    { name: "Jacquline Rossi", table: "Table 15", seat: "Seat 2" },
    { name: "Steven Tworow", table: "Table 15", seat: "Seat 3" },
    { name: "Tin Tworow", table: "Table 15", seat: "Seat 4" },
    { name: "Sam Vasanji", table: "Table 15", seat: "Seat 5" },
    { name: "Shyreen Haider", table: "Table 15", seat: "Seat 6" },
    { name: "Adrian Lomeli", table: "Table 15", seat: "Seat 7" },
    { name: "Susana Rodriguez", table: "Table 15", seat: "Seat 8" },

    // Table 16
    { name: "Jaeho Moon", table: "Table 16", seat: "Seat 1" },
    { name: "Eric Um", table: "Table 16", seat: "Seat 2" },
    { name: "Woobin Um", table: "Table 16", seat: "Seat 3" },
    { name: "Vicki Chen", table: "Table 16", seat: "Seat 4" },
    { name: "Emma Lee", table: "Table 16", seat: "Seat 5" },
    { name: "Mason Cho", table: "Table 16", seat: "Seat 6" },
    { name: "Rocky Cho", table: "Table 16", seat: "Seat 7" },

    // Table 17
    { name: "Aaron Kim", table: "Table 17", seat: "Seat 1" },
    { name: "Tae Kim", table: "Table 17", seat: "Seat 2" },
    { name: "Seungmin Ru", table: "Table 17", seat: "Seat 3" },
    { name: "Lua Ru", table: "Table 17", seat: "Seat 4" },
    { name: "Lui Ru", table: "Table 17", seat: "Seat 5" },
    { name: "Haeun Park", table: "Table 17", seat: "Seat 6" },
    { name: "Moon Kim", table: "Table 17", seat: "Seat 7" },
    { name: "Abigail Kim", table: "Table 17", seat: "Seat 8" },

    // Table 18
    { name: "Kyongho Kim", table: "Table 18", seat: "Seat 1" },
    { name: "Karam Hyun", table: "Table 18", seat: "Seat 2" },
    { name: "Mike Choi", table: "Table 18", seat: "Seat 3" },
    { name: "Junyoung Moon", table: "Table 18", seat: "Seat 4" },
    { name: "Minseob Shin", table: "Table 18", seat: "Seat 5" },
    { name: "Woosung Shim", table: "Table 18", seat: "Seat 6" },
    { name: "Jongwon Noh", table: "Table 18", seat: "Seat 7" },
    { name: "Min Sei Choi", table: "Table 18", seat: "Seat 8" },
  ];

  // --- Search helpers ----------------------------------------------------
  const norm = s => s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9\s]/g,'').replace(/\s+/g,' ').trim();
  const tokenize = s => norm(s).split(' ').filter(Boolean);

  function scoreMatch(qTokens, name){
    // Simple scoring: prefix match > token contain > substring contain
    const n = norm(name);
    const nameTokens = n.split(' ');
    let score = 0;
    for(const qt of qTokens){
      if(name.startsWith(qt)) score += 5;
      if(nameTokens.some(t => t.startsWith(qt))) score += 4;
      if(n.includes(qt)) score += 2;
    }
    return score;
  }

  function highlight(name, query){
    const q = norm(query);
    if(!q) return name;
    const words = [...new Set(tokenize(query))].sort((a,b)=>b.length-a.length);
    let html = name;
    for(const w of words){
      if(!w) continue;
      const re = new RegExp(`(${w})`, 'ig');
      html = html.replace(re, '<mark>$1</mark>');
    }
    return html;
  }

  const listEl = document.getElementById('list');
  const countEl = document.getElementById('resultCount');
  const inputEl = document.getElementById('searchBox');
  const clearBtn = document.getElementById('clearBtn');

  function render(matches, query){
    countEl.textContent = matches.length ? `${matches.length} result${matches.length>1?'s':''}` : (query ? 'No matching names found.' : '');
    listEl.innerHTML = matches.map(g=>{
      const pretty = highlight(g.name, query);
      const seatStr = `${g.table}, ${g.seat}`;
      const copyTxt = `${g.name} ‚Äì ${seatStr}`;
      return `<div class="guest-item">
        <div class="meta"><div class="who">${pretty}</div><div class="seat-pill">üçΩÔ∏è ${g.table} ‚Ä¢ ü™ë ${g.seat}</div></div>
        <button class="btn copy" data-copy="${copyTxt.replace(/"/g,'&quot;')}">Copy</button>
      </div>`
    }).join('');
  }

  function search(){
    const raw = inputEl.value; const q = norm(raw);
    if(!q){ render([], ''); return; }
    const qTokens = tokenize(raw);

    const results = guests
      .map(g=>({ g, s: scoreMatch(qTokens, g.name.toLowerCase()) }))
      .filter(x=> x.s>0 || norm(x.g.name).includes(q))
      .sort((a,b)=> b.s - a.s || a.g.name.localeCompare(b.g.name))
      .map(x=>x.g)
      .slice(0,25);

    render(results, raw);
  }

  // Debounce input for nicer UX
  let t; inputEl.addEventListener('input', ()=>{ clearTimeout(t); t = setTimeout(search, 80); });
  inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ // copy first result
    const btn = listEl.querySelector('button.copy'); if(btn){ btn.click(); }
  }});
  clearBtn.addEventListener('click', ()=>{ inputEl.value=''; inputEl.focus(); search(); });

  // Delegate copy buttons
  listEl.addEventListener('click', (e)=>{
    const btn = e.target.closest('button.copy');
    if(!btn) return;
    const text = btn.getAttribute('data-copy');
    navigator.clipboard?.writeText(text).then(()=>{
      const prev = btn.textContent; btn.textContent='Copied!'; btn.disabled=true;
      setTimeout(()=>{ btn.textContent=prev; btn.disabled=false; }, 1200);
    });
  });

  // URL deep-link: ?q=Name
  const params = new URLSearchParams(location.search);
  const qParam = params.get('q');
  if(qParam){ inputEl.value = qParam; search(); }
  else { inputEl.focus(); }

  // --- Lightbox / Zoom & Pan --------------------------------------------
  const dialog = document.getElementById('lightbox');
  const thumb = document.getElementById('thumb');
  const thumbLink = document.getElementById('thumbLink');
  const zoomImg = document.getElementById('zoomImg');
  const closeX = document.getElementById('closeX');

  let dragging=false, startX=0, startY=0, dx=0, dy=0;
  const setPos = ()=>{ zoomImg.style.setProperty('--dx', dx+'px'); zoomImg.style.setProperty('--dy', dy+'px'); };
  const resetZoom = ()=>{ dx=0; dy=0; zoomImg.style.setProperty('--scale', window.matchMedia('(max-width:480px)').matches?1.8:.9); setPos(); };

  thumbLink.addEventListener('click', (e)=>{ e.preventDefault(); dialog.showModal(); resetZoom(); });
  closeX.addEventListener('click', (e)=>{ e.preventDefault(); dialog.close(); });
  dialog.addEventListener('click', (e)=>{ if(e.target===dialog) dialog.close(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && dialog.open) dialog.close(); });

  zoomImg.addEventListener('pointerdown', (e)=>{
    e.preventDefault(); dragging=true; startX=e.clientX-dx; startY=e.clientY-dy; zoomImg.setPointerCapture(e.pointerId); zoomImg.style.cursor='grabbing';
  });
  zoomImg.addEventListener('pointermove', (e)=>{ if(!dragging) return; dx=e.clientX-startX; dy=e.clientY-startY; setPos(); });
  const stopDrag=()=>{ dragging=false; zoomImg.style.cursor='grab'; };
  zoomImg.addEventListener('pointerup', stopDrag); zoomImg.addEventListener('pointerleave', stopDrag);
  zoomImg.addEventListener('dblclick', ()=> resetZoom());

  // Optional: lazy-load image (in case you swap to a larger asset)
  document.querySelectorAll('img').forEach(img=> img.loading = 'lazy');
  </script>
  <script>
  // --- Table Pins --------------------------------------------------------
  const pinLayer = document.getElementById('pinLayer');
  const pinLayerDialog = document.getElementById('pinLayerDialog');

  // Ï¥àÍ∏∞ ÎåÄÎûµ Í∞í(ÌçºÏÑºÌä∏). Pin Edit Î™®ÎìúÎ°ú ÏÜêÏâΩÍ≤å Ïû¨Î∞∞Ïπò Í∞ÄÎä•.
  const defaultPins = {
    'Table 1': {x:12, y:18}, 'Table 2': {x:24, y:18}, 'Table 3': {x:36, y:18}, 'Table 4': {x:48, y:18},
    'Table 5': {x:60, y:18}, 'Table 6': {x:72, y:18}, 'Table 7': {x:84, y:18},
    'Table 8': {x:12, y:40}, 'Table 9': {x:24, y:40}, 'Table 10': {x:36, y:40}, 'Table 11': {x:48, y:40},
    'Table 12': {x:60, y:40}, 'Table 13': {x:72, y:40}, 'Table 14': {x:84, y:40},
    'Table 15': {x:24, y:66}, 'Table 16': {x:44, y:66}, 'Table 17': {x:64, y:66}, 'Table 18': {x:84, y:66},
  };
  let pins = { ...defaultPins, ...(JSON.parse(localStorage.getItem('tablePins')||'{}')) };

  function renderPinLayer(layer){
    if(!layer) return;
    layer.innerHTML = Object.entries(pins).map(([tbl, p]) =>
      `<div class="pin" data-table="${tbl}" style="left:${p.x}%; top:${p.y}%;">
         <div class="label">${tbl}</div>
         <div class="dot"></div>
       </div>`
    ).join('');
  }
  function refreshPins(){ renderPinLayer(pinLayer); renderPinLayer(pinLayerDialog); }
  refreshPins();

  // Í≤ÄÏÉâ Í≤∞Í≥ºÏôÄ Ïó∞ÎèôÌïòÏó¨ Ìï¥Îãπ ÌÖåÏù¥Î∏î ÌïÄ ÌïòÏù¥ÎùºÏù¥Ìä∏
  function highlightTable(table, opts){
    const open = opts && opts.open;
    document.querySelectorAll('.pin.highlight').forEach(el=> el.classList.remove('highlight'));
    const pin = document.querySelector(`#pinLayer .pin[data-table="${table}"]`);
    if(pin){ pin.classList.add('highlight'); pin.scrollIntoView({block:'center', inline:'center', behavior:'smooth'}); }
    else {
      const rc = document.getElementById('resultCount');
      if(rc) rc.textContent = `No map pin registered for ${table}. (Press E to edit pins)`;
    }
    if(open){
      const dlg = document.getElementById('lightbox');
      if(dlg && !dlg.open) dlg.showModal();
      const pinDlg = document.querySelector(`#pinLayerDialog .pin[data-table="${table}"]`);
      if(pinDlg) pinDlg.classList.add('highlight');
    }
  }

  // Í≤∞Í≥º Î¶¨Ïä§Ìä∏Ïóê 'Locate' Î≤ÑÌäº Ï£ºÏûÖ + ÌÅ¥Î¶≠ Ï≤òÎ¶¨ (Î†åÎçî Î∞©ÏãùÍ≥º Î¨¥Í¥ÄÌïòÍ≤å ÎèôÏûë)
  const listEl = document.getElementById('list');
  const mo = new MutationObserver(()=>{
    listEl.querySelectorAll('.guest-item').forEach(item=>{
      if(!item.querySelector('button.locate')){
        const btn = document.createElement('button');
        btn.className='btn locate'; btn.type='button'; btn.textContent='Locate';
        // pillÏóêÏÑú "Table N" Ï∂îÏ∂úÌï¥ data-table Îã¨Í∏∞
        const pill = item.querySelector('.seat-pill');
        const m = pill ? pill.textContent.match(/Table\s+\d+/i) : null;
        if(m) item.setAttribute('data-table', m[0].replace(/\s+/g,' ').trim());
        // Î≤ÑÌäº Î∞∞Ïπò(Î≥µÏÇ¨ Î≤ÑÌäº ÏòÜ)
        const copyBtn = item.querySelector('button.copy');
        if(copyBtn && copyBtn.parentElement) copyBtn.parentElement.prepend(btn);
        else item.appendChild(btn);
      }
    });
  });
  mo.observe(listEl, {childList:true, subtree:true});

  listEl.addEventListener('click', (e)=>{
    const gi = e.target.closest('.guest-item'); if(!gi) return;
    if(e.target.closest('button.locate')){
      const tbl = gi.getAttribute('data-table');
      if(tbl) highlightTable(tbl, {open:true});
    }
  });

  // Enter ÎàÑÎ•º Îïå Ï≤´ Í≤∞Í≥º ÌïÄ ÌïòÏù¥ÎùºÏù¥Ìä∏(Î≥µÏÇ¨ Î°úÏßÅÍ≥º ÎÇòÎûÄÌûà ÎèôÏûë)
  document.getElementById('searchBox').addEventListener('keydown', (e)=>{
    if(e.key==='Enter'){
      const first = listEl.querySelector('.guest-item');
      if(first){ highlightTable(first.getAttribute('data-table'), {open:false}); }
    }
  });

  // --- Pin Edit Î™®Îìú (E ÌÇ§Î°ú ÌÜ†Í∏Ä) --------------------------------------
  const editorBar = document.createElement('div');
  editorBar.style.cssText =
    'position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#ffffffdd;border:1px solid #e2d3d3;padding:8px 10px;border-radius:12px;display:none;gap:8px;align-items:center;z-index:1100;box-shadow:0 6px 20px rgba(0,0,0,.12)';
  editorBar.innerHTML =
    `‚öôÔ∏è Pin Edit <select id="tblSel">${
      Object.keys(defaultPins).map(t=>`<option>${t}</option>`).join('')
    }</select> <button id="savePins" class="btn" type="button">Save</button> <span style="font-size:.9rem;color:#6b6b6b">(Press E to toggle)</span>`;
  document.body.appendChild(editorBar);

  let editMode = false;
  function setEdit(v){
    editMode=v; editorBar.style.display = v?'flex':'none';
    const pl = document.querySelector('figure .plan-wrap'); if(pl) pl.style.cursor = v ? 'crosshair':'default';
  }
  document.addEventListener('keydown', (e)=>{ if(e.key.toLowerCase()==='e'){ setEdit(!editMode); }});

  // Ïç∏ÎÑ§Ïùº Ïù¥ÎØ∏ÏßÄÏóêÏÑú ÌÅ¥Î¶≠Ìïú ÏúÑÏπòÎ•º ÌçºÏÑºÌä∏ Ï¢åÌëúÎ°ú Ï†ÄÏû•
  document.querySelector('figure .plan-wrap').addEventListener('click', (e)=>{
    if(!editMode) return;
    const imgRect = document.getElementById('thumb').getBoundingClientRect();
    const xPct = ((e.clientX - imgRect.left) / imgRect.width) * 100;
    const yPct = ((e.clientY - imgRect.top) / imgRect.height) * 100;
    const sel = document.getElementById('tblSel');
    pins[sel.value] = {x: +xPct.toFixed(2), y: +yPct.toFixed(2)};
    refreshPins();
  });
  document.getElementById('savePins').addEventListener('click', ()=>{
    localStorage.setItem('tablePins', JSON.stringify(pins));
    const rc = document.getElementById('resultCount'); if(rc) rc.textContent = 'Pins saved ‚úîÔ∏è';
  });
</script>

</body>
</html>
