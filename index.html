<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <title>Wedding Seating Plan</title>
  <meta name="color-scheme" content="light" />
  <style>
    :root{
      --bg:#fdf8f4;--card:#fff;--ink:#222;--muted:#666;--ring:#d7c7b6;--shadow:0 4px 12px rgba(0,0,0,.12);
      --overlay:rgba(255,255,255,.85)
    }
    *{box-sizing:border-box}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple SD Gothic Neo", sans-serif;
      background:var(--bg);margin:0;padding:20px;text-align:center;color:var(--ink);
      overscroll-behavior:contain;
    }
    .wrap{max-width:960px;margin:0 auto}
    h1{font-size:clamp(1.25rem,2.5vw,1.8rem);margin:0 0 14px;line-height:1.35}
    .searchbar{display:flex;gap:8px;justify-content:center;align-items:center;margin:12px 0 10px}
    .clear-inline{display:inline-flex;align-items:center;gap:6px;background:#fff;border:1px solid #e5e1db;border-radius:10px;padding:10px 12px;box-shadow:var(--shadow)}
    .clear-inline input{border:none;outline:none;font-size:1.1rem}
    .btn-clear{display:none;margin-left:6px;border:none;background:#f1ebe5;color:#4b4239;border-radius:8px;padding:6px 10px;font-size:.95rem;cursor:pointer}
    .btn-clear.show{display:inline-block}
    label{position:absolute;clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;white-space:nowrap;width:1px}
    input[type="text"]{
      padding:12px 14px;font-size:1.1rem;width:min(90%,480px);border-radius:12px;border:1px solid #ccc;outline:none;
      box-shadow:var(--shadow);transition:border-color .15s ease;
    }
    input[type="text"]:focus{border-color:var(--ring)}

    .floorwrap{position:relative;display:inline-block;max-width:640px;width:100%}
    img.thumb{width:100%;max-width:640px;margin:0;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.18);cursor:zoom-in;display:block}

    /* Results overlay over the image */
    .overlay{position:absolute;left:8px;right:8px;top:8px;max-height:45vh;overflow:auto;padding:8px 8px 30px;border-radius:12px;background:var(--overlay);backdrop-filter:saturate(150%) blur(2px);box-shadow:var(--shadow);text-align:left}
    .overlay .clear-btn{position:absolute;top:6px;right:10px;background:none;border:none;font-size:28px;font-weight:bold;color:#333;cursor:pointer;line-height:1}
    .overlay .clear-btn:hover{color:#000}

    .result{font-size:1.05rem;margin-top:26px}
    .group{margin:6px 4px}
    .group h3{margin:8px 6px 6px;font-size:.95rem;color:#7a6d60;font-weight:700}
    .guest-item{margin:6px 6px;padding:10px;border-radius:10px;background:var(--card);box-shadow:var(--shadow);display:flex;justify-content:space-between;gap:8px;align-items:center}
    .guest-item strong{color:#444}
    .seat{white-space:nowrap;color:#4e473f;font-weight:600}
    mark{background:#fff0b3;padding:0 .15em;border-radius:.2em}

    .hint{font-size:.95rem;font-style:italic;margin:8px 0 14px;font-weight:700}

    /* Lightbox */
    .lightbox{display:none;position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,.85);justify-content:center;align-items:center;overflow:hidden}
    .lightbox:target{display:flex}
    .lightbox a.close{position:absolute;top:16px;right:20px;font-size:30px;color:#fff;text-decoration:none;z-index:1010}
    .stage{position:relative;width:100%;height:100%;touch-action:none}
    .stage img{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(1);will-change:transform;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.5);user-select:none;pointer-events:auto;max-width:90vw;max-height:90vh}

    @media (max-width:480px){
      input[type="text"]{font-size:1.1rem}
      .guest-item{font-size:1.05rem}
      .overlay{max-height:50vh}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Wedding Seating Plan üë∞‚ù§Ô∏èü§µ</h1>

    <div class="searchbar">
      <div class="clear-inline">
        <label for="searchBox">Search your name</label>
        <input id="searchBox" type="text" inputmode="text" autocomplete="name" placeholder="Enter your name here..." aria-controls="result" aria-autocomplete="list" aria-describedby="help" autofocus />
        <button id="clearInput" class="btn-clear" type="button" aria-label="Clear search">Clear</button>
      </div>
    </div>

    <div class="hint">*Seats arranged clockwise from the north ü™ë</div>

    <!-- Floorplan thumbnail with overlay results -->
    <div class="floorwrap">
      <a href="#floorplan"><img class="thumb" src="Seating_Plan_Final.jpg" alt="Wedding floor plan preview"></a>
      <div class="overlay" id="overlay" hidden>
        <button class="clear-btn" id="clearBtn" aria-label="Clear search">‚úï</button>
        <div id="result" class="result" aria-live="polite"></div>
      </div>
    </div>
    <p style="font-size:0.95rem; color:#555; margin-top:6px;">Tap the image to enlarge</p>
    <p style="font-size:0.95rem; color:#555; margin-top:2px;">Ïù¥ÎØ∏ÏßÄÎ•º ÌÅ¥Î¶≠ÌïòÏãúÎ©¥ ÌôïÎåÄÌïòÏã§ Ïàò ÏûàÏñ¥Ïöî</p>
  </div>

  <!-- Lightbox -->
  <div id="floorplan" class="lightbox" role="dialog" aria-modal="true" aria-label="Floor plan zoom">
    <a class="close" href="#" aria-label="Close">‚úï</a>
    <div class="stage">
      <img id="zoomImg" src="Seating_Plan_Final.jpg" alt="Wedding floor plan large">
    </div>
  </div>

<script src="guests.js"></script>
<script>
const guests = window.GUESTS || [];
const $ = sel => document.querySelector(sel);
const resultDiv = $('#result');
const overlay = $('#overlay');
const clearBtn = $('#clearBtn');
const box = $('#searchBox');
const clearInlineBtn = $('#clearInput');

const norm = s => (s||"")
  .toLowerCase()
  .normalize('NFKD')
  .replace(/[\u0300-\u036f]/g, '')
  .replace(/\s+/g,' ')
  .trim();

function editDistance(a,b,max=2){
  if(Math.abs(a.length-b.length)>max) return max+1;
  const dp = new Array(b.length+1);
  for(let j=0;j<=b.length;j++) dp[j]=j;
  for(let i=1;i<=a.length;i++){
    let prev = i-1; dp[0]=i;
    for(let j=1;j<=b.length;j++){
      const tmp = dp[j];
      dp[j] = a[i-1]===b[j-1]? prev : 1+Math.min(prev, dp[j], dp[j-1]);
      prev = tmp;
    }
  }
  return dp[b.length];
}

function highlight(name, query){
  const idx = name.toLowerCase().indexOf(query.toLowerCase());
  if(idx<0) return name;
  return name.slice(0,idx)+'<mark>'+name.slice(idx, idx+query.length)+'</mark>'+name.slice(idx+query.length);
}

function groupByTable(list){
  const map = new Map();
  for(const g of list){
    if(!map.has(g.table)) map.set(g.table, []);
    map.get(g.table).push(g);
  }
  return [...map.entries()].sort((a,b)=>{
    const an = parseInt(a[0].match(/(\d+)/)?.[1]||'0',10);
    const bn = parseInt(b[0].match(/(\d+)/)?.[1]||'0',10);
    return an-bn;
  });
}

function debounce(fn, wait=120){
  let t;return (...args)=>{clearTimeout(t);t=setTimeout(()=>fn(...args),wait)}
}

function searchGuest(){
  const q = norm(box.value);
  if(!q){ resultDiv.innerHTML=''; overlay.hidden = true; clearInlineBtn?.classList.remove('show'); return; }

  clearInlineBtn?.classList.add('show');

  const scored = guests.map(g=>{
    const nameN = norm(g.name);
    let score = Infinity;
    if(nameN===q) score=0;
    else if(nameN.startsWith(q) || nameN.split(' ').some(t=>t.startsWith(q))) score=1;
    else if(nameN.includes(q)) score=2;
    else if(editDistance(nameN, q, 2)<=2) score=3;
    return { ...g, score };
  }).filter(x=>x.score!==Infinity)
    .sort((a,b)=> a.score-b.score || a.name.localeCompare(b.name));

  if(scored.length===0){
    resultDiv.innerHTML = `<span style="color:#cc0000">No matching names found.</span>`;
    overlay.hidden = false;
    return;
  }

  const grouped = groupByTable(scored);
  const qRaw = box.value.trim();
  const html = grouped.map(([table, items])=>{
    const itemsHtml = items.map(g=>
      `<div class="guest-item"><strong>${highlight(g.name, qRaw)}</strong><span class="seat">üçΩÔ∏è ${g.table}, ü™ë ${g.seat}</span></div>`
    ).join('');
    return `<div class="group"><h3>${table}</h3>${itemsHtml}</div>`;
  }).join('');

  resultDiv.innerHTML = html;
  overlay.hidden = false;
}

box.addEventListener('input', debounce(searchGuest, 120));

function clearSearch(){
  box.value='';
  resultDiv.innerHTML='';
  overlay.hidden=true;
  clearInlineBtn?.classList.remove('show');
  const url = new URL(location);
  url.searchParams.delete('q');
  history.replaceState({}, '', url);
  box.focus();
}

clearBtn.addEventListener('click', clearSearch);
clearInlineBtn?.addEventListener('click', clearSearch);
box.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ e.preventDefault(); clearSearch(); } });

(function initFromURL(){
  const params = new URLSearchParams(location.search);
  const q = params.get('q');
  if(q){ box.value = q; searchGuest(); box.focus(); box.select(); }
})();

(function syncURL(){
  let last = '';
  box.addEventListener('input', debounce(()=>{
    const v = box.value.trim();
    if(v===last) return; last=v;
    const url = new URL(location);
    if(v) url.searchParams.set('q', v); else url.searchParams.delete('q');
    history.replaceState({}, '', url);
  }, 200));
})();

// --- Lightbox pan, pinch-zoom (mobile), wheel (desktop) ---
(function setupPanZoom(){
  const img = document.getElementById('zoomImg');
  let scale = 1, tx = 0, ty = 0;
  let dragging = false, sx=0, sy=0;
  let pointers = new Map();

  const clampScale = (s)=>{
    const isMobile = matchMedia('(max-width: 768px)').matches;
    const max = isMobile ? 3 : 5;
    return Math.min(max, Math.max(1, s));
  };

  const apply = ()=>{
    img.style.transform = `translate(calc(-50% + ${tx}px), calc(-50% + ${ty}px)) scale(${scale})`;
  };

  function distance(a,b){ const dx=a.clientX-b.clientX, dy=a.clientY-b.clientY; return Math.hypot(dx,dy); }
  function midpoint(a,b){ return { x:(a.clientX+b.clientX)/2, y:(a.clientY+b.clientY)/2 }; }

  img.addEventListener('pointerdown', e=>{
    e.preventDefault();
    pointers.set(e.pointerId, e);
    img.setPointerCapture(e.pointerId);
    if(pointers.size===1){
      dragging=true; sx = e.clientX; sy = e.clientY; img.style.cursor='grabbing';
    }
  });

  img.addEventListener('pointermove', e=>{
    if(!pointers.has(e.pointerId)) return;
    const prev = pointers.get(e.pointerId);
    pointers.set(e.pointerId, e);

    if(pointers.size===1 && dragging){
      tx += (e.clientX - sx); ty += (e.clientY - sy); sx=e.clientX; sy=e.clientY; apply();
    }
    else if(pointers.size===2){
      const [p1, p2] = [...pointers.values()];
      const [q1, q2] = [prev, [...pointers.entries()].find(([id])=>id!==e.pointerId)?.[1] || p2];
      const before = distance(q1, q2);
      const after = distance(p1, p2);
      if(before>0){
        const factor = after / before;
        const next = clampScale(scale * factor);
        const rect = img.getBoundingClientRect();
        const m = midpoint(p1, p2);
        const cx = m.x - rect.left - rect.width/2;
        const cy = m.y - rect.top - rect.height/2;
        tx -= cx * (next/scale - 1);
        ty -= cy * (next/scale - 1);
        scale = next; apply();
      }
    }
  });

  function endPointer(e){
    pointers.delete(e.pointerId);
    if(pointers.size===0){ dragging=false; img.style.cursor='grab'; }
  }
  img.addEventListener('pointerup', endPointer);
  img.addEventListener('pointercancel', endPointer);
  img.addEventListener('pointerleave', endPointer);

  img.addEventListener('wheel', e=>{
    e.preventDefault();
    const delta = -Math.sign(e.deltaY) * 0.1;
    const next = clampScale(scale + delta);
    if(next!==scale){
      const rect = img.getBoundingClientRect();
      const cx = e.clientX - rect.left - rect.width/2;
      const cy = e.clientY - rect.top - rect.height/2;
      tx -= cx * (next/scale - 1);
      ty -= cy * (next/scale - 1);
      scale = next; apply();
    }
  }, { passive:false });

  let lastTap = 0;
  img.addEventListener('click', e=>{
    const now = Date.now();
    if(now - lastTap < 300){
      e.preventDefault();
      if(scale===1){ scale=1.5; } else { scale=1; tx=ty=0; }
      apply();
    }
    lastTap = now;
  });

  window.addEventListener('hashchange', ()=>{
    if(location.hash !== '#floorplan'){ scale=1; tx=ty=0; apply(); }
  });

  apply();
})();
</script>
</body>
</html>








